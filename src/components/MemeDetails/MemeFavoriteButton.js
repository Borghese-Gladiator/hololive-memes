import React from 'react';
import Button from '@material-ui/core/Button';
import Snackbar from '@material-ui/core/Snackbar';
import MuiAlert from '@material-ui/lab/Alert';
// icons
import FavoriteIcon from '@material-ui/icons/Favorite';

function Alert(props) {
  return <MuiAlert elevation={6} variant="filled" {...props} />;
}

export default function MemeCard(props) {
  const { path, title, postID } = props;

  const [open, setOpen] = React.useState(false);
  const [isValid, setIsValid] = React.useState(true);

  const handleClick = () => {  
    // add to localStorage history
    const favoriteListStr = localStorage.getItem('favorites');
    if (!favoriteListStr) {
      // does not exist
      localStorage.setItem('favorites', JSON.stringify([{
        imgPath: path,
        title: title,
        id: postID
      }]));
    } else {
      const favoriteList = JSON.parse(favoriteListStr);
      if (favoriteList.includes(postID)) {
        // duplicates present
        setIsValid(false);
      } else {
        setIsValid(true);
        favoriteList.push(JSON.stringify({
          imgPath: path,
          title: title,
          id: postID
        }));
        localStorage.setItem('favorites', JSON.stringify(favoriteList));
      }
    }
    // display alert after determining if valid
    setOpen(true);
  }

  function showAlert(isValid) {
    return isValid ? 
      <Alert onClose={handleClose} severity="info">
        Added to favorites!
      </Alert>
      :
      <Alert onClose={handleClose} severity="error">
        Duplicate key - it's already added!
      </Alert>
  }

  const handleClose = (event, reason) => {
    if (reason === 'clickaway') {
      return;
    }
    setOpen(false);
  };

  return (
    <div>
      <Button variant="contained" color="primary" onClick={handleClick}>
        <FavoriteIcon style={{marginRight: 8}} />
        Favorite
      </Button>
      <Snackbar open={open} autoHideDuration={6000} onClose={handleClose}>
        {showAlert(isValid)}
      </Snackbar>
    </div>
  )
}